{{if .Hosts}}
<table>
    <colgroup>
        <col style="width: 12%">
        <col style="width: 12%">
        <col style="width: 18%">
        <col style="width: 15%">
        <col style="width: 15%">
        <col style="width: 28%">
    </colgroup>
    <thead>
        <tr>
            <th>Hostname</th>
            <th>Power</th>
            <th>ISO</th>
            <th>Config</th>
            <th>Last Boot</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {{range .Hosts}}
        <tr>
            <td class="hostname">
                {{if .Hostname}}<a onclick="showHostDetail('{{.MAC}}')">{{.Hostname}}</a>{{else}}<a onclick="showHostDetail('{{.MAC}}')"><em>({{.MAC}})</em></a>{{end}}
            </td>
            <td class="power-status">
                {{if and .IPMIIP .Hostname}}
                <span class="power-badge power-unknown" hx-get="/api/host/ipmi/status?host={{.Hostname}}" hx-trigger="load" hx-swap="outerHTML">...</span>
                {{else}}-{{end}}
            </td>
            <td>
                <select hx-post="/api/host?mac={{.MAC}}&action=set_image" hx-swap="none" hx-trigger="change" name="image"
                        hx-on::after-request="htmx.trigger(document.body, 'hostsUpdated')"
                        onchange="updateConfigDropdown(this)">
                    {{$current := .CurrentImage}}
                    <option value="localboot" {{if eq $current "localboot"}}selected{{end}}>localboot</option>
                    {{range $.CDROMs}}
                    <option value="{{.Name}}" {{if eq .Name $current}}selected{{end}}>{{.Name}}</option>
                    {{end}}
                </select>
            </td>
            <td>
                {{$hostname := .Hostname}}
                {{$configRef := index $.ConfigRefs .Hostname}}
                {{$currentImage := .CurrentImage}}
                <select hx-post="/api/host?mac={{.MAC}}&action=set_config" hx-swap="none" hx-trigger="change" name="config"
                        hx-on::after-request="htmx.trigger(document.body, 'hostsUpdated')"
                        data-hostname="{{.Hostname}}" class="config-select">
                    <option value="">(none)</option>
                    {{range $.CDROMs}}
                        {{if eq .Name $currentImage}}
                            {{range .BootConfigs}}
                            <option value="{{.}}" {{if eq . $configRef}}selected{{end}}>{{.}}</option>
                            {{end}}
                        {{end}}
                    {{end}}
                </select>
            </td>
            <td class="timestamp">{{if .LastBoot}}{{.LastBoot}}{{else}}-{{end}}</td>
            <td>
                <div class="btn-group">
                    {{$canIPMI := and .IPMIIP .Hostname}}
                    <button class="success" hx-post="/api/host/ipmi?host={{.Hostname}}&action=power_on" hx-swap="none"{{if not $canIPMI}} disabled{{end}}>On</button>
                    <button class="danger" hx-post="/api/host/ipmi?host={{.Hostname}}&action=power_off" hx-swap="none"{{if not $canIPMI}} disabled{{end}}>Off</button>
                    <button class="secondary" hx-post="/api/host/ipmi?host={{.Hostname}}&action=restart" hx-swap="none"{{if not $canIPMI}} disabled{{end}}>Restart</button>
                    <a href="http://ipmiserial.g11.lo/#{{if .Hostname}}{{.Hostname}}{{else}}{{.MAC}}{{end}}" target="_blank" class="btn secondary">Console</a>
                </div>
            </td>
        </tr>
        {{end}}
    </tbody>
</table>
{{else}}
<div class="empty">No hosts registered. Hosts are auto-registered on first PXE boot.</div>
{{end}}
