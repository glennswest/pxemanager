{{if .Hosts}}
<table>
    <thead>
        <tr>
            <th>Hostname</th>
            <th>Power</th>
            <th>Current Image</th>
            <th>Status</th>
            <th>Last Boot</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {{range .Hosts}}
        <tr>
            <td class="hostname">
                {{if .Hostname}}<a onclick="showHostDetail('{{.MAC}}')">{{.Hostname}}</a>{{else}}<a onclick="showHostDetail('{{.MAC}}')"><em>({{.MAC}})</em></a>{{end}}
            </td>
            <td class="power-status">
                {{if and .IPMIIP .Hostname}}
                <span class="power-badge power-unknown" hx-get="/api/host/ipmi/status?host={{.Hostname}}" hx-trigger="load, every 30s" hx-swap="outerHTML">...</span>
                {{else}}-{{end}}
            </td>
            <td>
                <select hx-post="/api/host?mac={{.MAC}}&action=set_image" hx-swap="none" hx-trigger="change" name="image"
                        hx-on::after-request="htmx.trigger(document.body, 'hostsUpdated')">
                    {{$current := .CurrentImage}}
                    {{range $.Images}}
                    <option value="{{.Name}}" {{if eq .Name $current}}selected{{end}}>{{.Name}}</option>
                    {{end}}
                </select>
            </td>
            <td>
                {{if .NextImage}}<span class="badge badge-next">Next: {{.NextImage}}</span>
                {{else if .CycleImages}}<span class="badge badge-cycle">Cycle</span>
                {{else}}<span style="color:#6bcb77">Ready</span>{{end}}
            </td>
            <td class="timestamp">{{if .LastBoot}}{{.LastBoot}}{{else}}-{{end}}</td>
            <td>
                <div class="btn-group">
                    {{$canIPMI := and .IPMIIP .Hostname}}
                    <button class="success" hx-post="/api/host/ipmi?host={{.Hostname}}&action=power_on" hx-swap="none"{{if not $canIPMI}} disabled{{end}}>On</button>
                    <button class="danger" hx-post="/api/host/ipmi?host={{.Hostname}}&action=power_off" hx-swap="none"{{if not $canIPMI}} disabled{{end}}>Off</button>
                    <button class="secondary" hx-post="/api/host/ipmi?host={{.Hostname}}&action=restart" hx-swap="none"{{if not $canIPMI}} disabled{{end}}>Restart</button>
                    <a href="http://ipmiserial.g11.lo/#{{if .Hostname}}{{.Hostname}}{{else}}{{.MAC}}{{end}}" target="_blank" class="btn secondary">Console</a>
                </div>
            </td>
        </tr>
        {{end}}
    </tbody>
</table>
{{else}}
<div class="empty">No hosts registered. Hosts are auto-registered on first PXE boot.</div>
{{end}}
